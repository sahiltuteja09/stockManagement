<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      My Bills
    </ion-title>
    <ion-buttons slot="secondary" routerLink="/purchases">
      <ion-button>
        <ion-icon slot="icon-only" name="add"></ion-icon> Add New
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content>

    <ion-row>
        <ion-col size="6" size-sm align-items-start>
            <ion-item>
                <ion-label position="floating">Start</ion-label>
                <ion-datetime displayFormat="DD-MM-YYYY" [(ngModel)]="startDate"></ion-datetime>
              </ion-item>
        </ion-col>
        <ion-col size="6" size-sm align-items-start>
            <ion-item>
                <ion-label position="floating">End</ion-label>
                <ion-datetime displayFormat="DD-MM-YYYY" [(ngModel)]="endDate"></ion-datetime>
              </ion-item>
        </ion-col>
        <ion-col size="5" size-sm align-items-start>
            <ion-item>
                <ion-label position="floating">Keyword
                </ion-label>
                <ion-input type="text" [(ngModel)]="keyword" name="keyword"></ion-input>
              </ion-item>
        </ion-col>
      
        <ion-col size="7" size-sm align-items-start>
            <ion-list>
          <ion-button color="success" (click)="filterReport()">
              <ion-icon slot="start" name="search"></ion-icon>
            GO</ion-button>
            <a color="success" (click)="clearFileter()">
              Clear Filter</a>
          </ion-list>
      </ion-col>
    </ion-row>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Pull to refresh" refreshingSpinner="circles"
      refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>
  <div *ngIf="(mypurchases.status); else noData">
    <ion-list>
      <ion-card>
        <ion-item>
          <ion-col size="12" size-sm align-items-end>
            <p>
              Your {{isFiltered ? 'Filter' : 'Life Time'}} Purhcase Cost is Rs. {{lifeTimePurchase}}/-
            </p>
          </ion-col>
        </ion-item>
      </ion-card>
    </ion-list>
    <ion-list *ngFor="let purchase of mypurchases.data">
      <ion-card>
        <ion-item>
          <ion-thumbnail slot="start">
            <img [src]="purchase.image ? img_base+purchase.image : defaultImage" tappable (click)="openPreview(purchase.image ? img_base+purchase.image : defaultImage)">
          </ion-thumbnail>
          <ion-label>
            <p> Rs. {{purchase.totalcost}}/- is your purchase amount.<ion-icon name="create"
                routerLink="/purchases/{{purchase.id}}"></ion-icon>
            </p>
            <ion-row>
              <ion-col size="9" size-sm align-items-end>
                <small class="deal_price">
                  Vendor : {{purchase.name}} (<a href="javascript:void(0)" (click)="callToVendor(purchase.mobile_number)"> {{purchase.mobile_number}} </a>)
                </small>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="9" size-sm align-items-end>
                <small class="deal_price">
                  Purchase Date : {{purchase.purchase_date}}
                </small>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="9" size-sm align-items-end>
                <small class="deal_price">
                  Last updated on - {{purchase.date_modify | timeAgo}}
                </small>
              </ion-col>
            </ion-row>
            <ion-col size="3" size-sm>
              <ion-button routerLink="/purchases/{{purchase.id}}" float-right color="tertiary" shape="round"
                size="small">
                <ion-icon name="create"></ion-icon> Edit
              </ion-button>
            </ion-col>
          </ion-label>

        </ion-item>
        <ion-row>
          <ion-col size="12" size-sm>
            <p [innerHTML]="purchase.description | safehtml">

            </p>
          </ion-col>
        </ion-row>
      </ion-card>

    </ion-list>
  </div>
  <ng-template #noData>
    <div class="ion-text-center">
      {{noDataFound}}
    </div>
  </ng-template>
  <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more data...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>